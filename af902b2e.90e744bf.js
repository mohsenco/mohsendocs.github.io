(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{79:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return o})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(2),r=a(6),i=(a(0),a(94)),c={id:"repo-php-fpm-zts",title:"PHP + FPM + ZTS",sidebar_label:"PHP + FPM + ZTS"},o={unversionedId:"projects/repo-php-fpm-zts",id:"projects/repo-php-fpm-zts",isDocsHomePage:!1,title:"PHP + FPM + ZTS",description:"The repository of this docs is on GitHub https://github.com/mohsenmottaghi/php-fpm-zts",source:"@site/docs/projects/repo-php-fpm-zts.md",permalink:"/docs/projects/repo-php-fpm-zts",editUrl:"https://github.com/mohsenco/mohsendocs.github.io/docs/projects/repo-php-fpm-zts.md",sidebar_label:"PHP + FPM + ZTS",sidebar:"someSidebar",previous:{title:"NGINX Pagespeed",permalink:"/docs/projects/repo-nginx-pagespeed"}},s=[{value:"Build Status",id:"build-status",children:[]},{value:"How to use this image",id:"how-to-use-this-image",children:[]},{value:"How to install more PHP extensions",id:"how-to-install-more-php-extensions",children:[{value:"PHP Core Extensions",id:"php-core-extensions",children:[]},{value:"Default extensions",id:"default-extensions",children:[]},{value:"PECL extensions",id:"pecl-extensions",children:[]},{value:"Other extensions",id:"other-extensions",children:[]}]}],l={rightToc:s};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("div",{className:"admonition admonition-important alert alert--info"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"The repository of this docs is on GitHub ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/mohsenmottaghi/php-fpm-zts"}),"https://github.com/mohsenmottaghi/php-fpm-zts")))),Object(i.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"This docs is not ready"))),Object(i.b)("h1",{id:"dockerfile-php-fpm-with-zts"},"Dockerfile PHP-FPM with ZTS"),Object(i.b)("p",null,Object(i.b)("img",Object(n.a)({parentName:"p"},{src:"https://img.shields.io/badge/PHP_Version-7.4-darkgreen.svg",alt:"Generic badge"}))," ",Object(i.b)("img",Object(n.a)({parentName:"p"},{src:"https://img.shields.io/badge/PHP_Version-7.3-darkgreen.svg",alt:"Generic badge"}))," ",Object(i.b)("img",Object(n.a)({parentName:"p"},{src:"https://img.shields.io/badge/PHP_Version-7.2-darkgreen.svg",alt:"Generic badge"}))," ",Object(i.b)("img",Object(n.a)({parentName:"p"},{src:"https://img.shields.io/badge/Automatic_Build-OK-%3CCOLOR%3E.svg",alt:"Generic badge"}))," ",Object(i.b)("img",Object(n.a)({parentName:"p"},{src:"https://img.shields.io/badge/Project_phase-BETA-blue.svg",alt:"Generic badge"}))),Object(i.b)("p",null,"This repo cloned from ",Object(i.b)("inlineCode",{parentName:"p"},"docker-library/php")),Object(i.b)("h2",{id:"build-status"},"Build Status"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Dockerfile"),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Base Image"),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"PHP Version"),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Tag"),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Docker Hub Build"),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"GitHub Build"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.4/buster/Dockerfile"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"debian:buster-slim"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.4"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"latest"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://img.shields.io/badge/Build_DockerHub-Pass-%3CCOLOR%3E.svg",alt:"Generic badge"}))),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://github.com/mohsenmottaghi/php-fpm-zts/workflows/Dockerfile%20Debian%20Buster%20-%20Latest%20CI/badge.svg",alt:"Dockerfile Debian Buster - Latest CI"})))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.4/buster/Dockerfile"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"debian:buster-slim"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.4"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.4"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://img.shields.io/badge/Build_DockerHub-Pass-%3CCOLOR%3E.svg",alt:"Generic badge"}))),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://github.com/mohsenmottaghi/php-fpm-zts/workflows/Dockerfile%20Debian%20Buster%20-%207.4%20CI/badge.svg",alt:"Dockerfile Debian Buster - 7.4 CI"})))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.3/buster/Dockerfile"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"debian:buster-slim"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.3"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.3"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://img.shields.io/badge/Build_DockerHub-Pass-%3CCOLOR%3E.svg",alt:"Generic badge"}))),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://github.com/mohsenmottaghi/php-fpm-zts/workflows/Dockerfile%20Debian%20Buster%20-%207.3%20CI/badge.svg",alt:"Dockerfile Debian Buster - 7.3 CI"})))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.2/buster/Dockerfile"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"debian:buster-slim"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.2"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"7.2"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://img.shields.io/badge/Build_DockerHub-Pass-%3CCOLOR%3E.svg",alt:"Generic badge"}))),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(i.b)("img",Object(n.a)({parentName:"td"},{src:"https://github.com/mohsenmottaghi/php-fpm-zts/workflows/Dockerfile%20Debian%20Buster%20-%207.2%20CI/badge.svg",alt:"Dockerfile Debian Buster - 7.2 CI"})))))),Object(i.b)("h2",{id:"how-to-use-this-image"},"How to use this image"),Object(i.b)("p",null,"Create a Dockerfile in your PHP project."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"FROM mohsenmottaghi/php-fpm-zts:latest\nCOPY . /var/www/html\n")),Object(i.b)("p",null,"Then, run the commands to build and run the Docker image:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"$ docker build -t my-php-app .\n$ docker run -it --rm --name my-running-app my-php-app\n")),Object(i.b)("h2",{id:"how-to-install-more-php-extensions"},"How to install more PHP extensions"),Object(i.b)("p",null,"Many extensions are already compiled into the image, so it's worth checking the output of php -m or php -i before going through the effort of compiling more."),Object(i.b)("p",null,"We provide the helper scripts docker-php-ext-configure, docker-php-ext-install, and docker-php-ext-enable to more easily install PHP extensions."),Object(i.b)("p",null,"In order to keep the images smaller, PHP's source is kept in a compressed tar file. To facilitate linking of PHP's source with any extension, we also provide the helper script docker-php-source to easily extract the tar or delete the extracted source. Note: if you do use docker-php-source to extract the source, be sure to delete it in the same layer of the docker image."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"FROM mohsenmottaghi/php-fpm-zts:latest\nRUN docker-php-source extract \\\n    # do important things \\\n    && docker-php-source delete\n")),Object(i.b)("h3",{id:"php-core-extensions"},"PHP Core Extensions"),Object(i.b)("p",null,"For example, if you want to have a PHP-FPM image with the gd extension, you can inherit the base image that you like, and write your own Dockerfile like this:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"FROM mohsenmottaghi/php-fpm-zts:latest\nRUN apt-get update && apt-get install -y \\\n        libfreetype6-dev \\\n        libjpeg62-turbo-dev \\\n        libpng-dev \\\n    && docker-php-ext-configure gd --with-freetype --with-jpeg \\\n    && docker-php-ext-install -j$(nproc) gd\n")),Object(i.b)("p",null,"Remember, you must install dependencies for your extensions manually. If an extension needs custom configure arguments, you can use the docker-php-ext-configure script like this example. There is no need to run docker-php-source manually in this case, since that is handled by the configure and install scripts."),Object(i.b)("p",null,"If you are having difficulty figuring out which Debian or Alpine packages need to be installed before docker-php-ext-install, then have a look at ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/mlocati/docker-php-extension-installer"}),"the install-php-extensions project"),". This script builds upon the docker-php-ext-* scripts and simplifies the installation of PHP extensions by automatically adding and removing Debian (apt) and Alpine (apk) packages. For example, to install the GD extension you simply have to run install-php-extensions gd. This tool is contributed by community members and is not included in the images, please refer to their Git repository for installation, usage, and issues."),Object(i.b)("p",null,'See also "',Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://tianon.xyz/post/2017/12/26/dockerize-compiled-software.html"}),"Dockerizing Compiled Software"),'" for a description of the technique Tianon uses for determining the necessary build-time dependencies for any bit of software (which applies directly to compiling PHP extensions).'),Object(i.b)("h3",{id:"default-extensions"},"Default extensions"),Object(i.b)("p",null,"Some extensions are compiled by default. This depends on the PHP version you are using. Run php -m in the container to get a list for your specific version."),Object(i.b)("h3",{id:"pecl-extensions"},"PECL extensions"),Object(i.b)("p",null,"Some extensions are not provided with the PHP source, but are instead available through PECL. To install a PECL extension, use pecl install to download and compile it, then use docker-php-ext-enable to enable it:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"FROM mohsenmottaghi/php-fpm-zts:latest\nRUN pecl install redis-5.1.1 \\\n    && pecl install xdebug-2.8.1 \\\n    && docker-php-ext-enable redis xdebug\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"FROM mohsenmottaghi/php-fpm-zts:latest\nRUN apt-get update && apt-get install -y libmemcached-dev zlib1g-dev \\\n    && pecl install memcached-2.2.0 \\\n    && docker-php-ext-enable memcached\n")),Object(i.b)("p",null,"It is strongly recommended that users use an explicit version number in their pecl install invocations to ensure proper PHP version compatibility (PECL does not check the PHP version compatiblity when choosing a version of the extension to install, but does when trying to install it)."),Object(i.b)("p",null,"For example, memcached-2.2.0 has no PHP version constraints (",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://pecl.php.net/package/memcached/2.2.0"}),"https://pecl.php.net/package/memcached/2.2.0"),"), but memcached-3.1.4 requires PHP 7.0.0 or newer (",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://pecl.php.net/package/memcached/3.1.4"}),"https://pecl.php.net/package/memcached/3.1.4"),"). When doing pecl install memcached (no specific version) on PHP 5.6, PECL will try to install the latest release and fail."),Object(i.b)("p",null,"Beyond the compatibility issue, it's also a good practice to ensure you know when your dependencies receive updates and can control those updates directly."),Object(i.b)("p",null,"Unlike PHP core extensions, PECL extensions should be installed in series to fail properly if something went wrong. Otherwise errors are just skipped by PECL. For example, pecl install memcached-3.1.4 && pecl install redis-5.1.1 instead of pecl install memcached-3.1.4 redis-5.1.1. However, docker-php-ext-enable memcached redis is fine to be all in one command."),Object(i.b)("h3",{id:"other-extensions"},"Other extensions"),Object(i.b)("p",null,"Some extensions are not provided via either Core or PECL; these can be installed too, although the process is less automated:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"FROM mohsenmottaghi/php-fpm-zts:latest\nRUN curl -fsSL 'https://xcache.lighttpd.net/pub/Releases/3.2.0/xcache-3.2.0.tar.gz' -o xcache.tar.gz \\\n    && mkdir -p xcache \\\n    && tar -xf xcache.tar.gz -C xcache --strip-components=1 \\\n    && rm xcache.tar.gz \\\n    && ( \\\n        cd xcache \\\n        && phpize \\\n        && ./configure --enable-xcache \\\n        && make -j \"$(nproc)\" \\\n        && make install \\\n    ) \\\n    && rm -r xcache \\\n    && docker-php-ext-enable xcache\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"docker-php-ext-*")," scripts can accept an arbitrary path, but it must be absolute (to disambiguate from built-in extension names), so the above example could also be written as the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"FROM mohsenmottaghi/php-fpm-zts:latest\nRUN curl -fsSL 'https://xcache.lighttpd.net/pub/Releases/3.2.0/xcache-3.2.0.tar.gz' -o xcache.tar.gz \\\n    && mkdir -p /tmp/xcache \\\n    && tar -xf xcache.tar.gz -C /tmp/xcache --strip-components=1 \\\n    && rm xcache.tar.gz \\\n    && docker-php-ext-configure /tmp/xcache --enable-xcache \\\n    && docker-php-ext-install /tmp/xcache \\\n    && rm -r /tmp/xcache\n")))}p.isMDXComponent=!0},94:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return h}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),b=p(a),m=n,h=b["".concat(c,".").concat(m)]||b[m]||d[m]||i;return a?r.a.createElement(h,o(o({ref:t},l),{},{components:a})):r.a.createElement(h,o({ref:t},l))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,c=new Array(i);c[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:n,c[1]=o;for(var l=2;l<i;l++)c[l]=a[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);